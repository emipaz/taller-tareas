{# 
  Plantilla: Establecer Contrase√±a Inicial
  
  Descripci√≥n:
    Formulario para que los usuarios nuevos establezcan su contrase√±a
    por primera vez. Los admins crean usuarios sin contrase√±a, y estos
    deben establecerla en su primer acceso.
  
  Variables de contexto:
    - username (str): Nombre del usuario que est√° estableciendo su contrase√±a
    - error (str, opcional): Mensaje de error si algo fall√≥
  
  Endpoints:
    - POST /set-password: Establece la contrase√±a inicial del usuario
  
  Dependencias:
    - /static/main.css: Estilos globales
    - /static/common.js: Funci√≥n togglePasswordVisibility y validatePassword
  
  Flujo:
    1. Usuario nuevo es redirigido aqu√≠ desde login
    2. Ingresa su nueva contrase√±a dos veces (con opci√≥n de verlas)
    3. Valida que las contrase√±as coincidan
    4. Al enviar, se guarda encriptada en el sistema
    5. Redirige autom√°ticamente al dashboard
#}
<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Establecer Contrase√±a</title>
    <link rel="stylesheet" href="/static/main.css" />
    <script src="/static/common.js"></script>
  </head>
  <body>
    {# Encabezado #}
    <header>
      <h1>Establecer Contrase√±a</h1>
    </header>

    <main>
      {# Mensaje informativo para el usuario #}
      <div style="background-color: #d1ecf1; color: #0c5460; padding: 15px; margin: 20px auto; max-width: 520px; border-radius: 4px; border: 1px solid #bee5eb; text-align: center;">
        <strong>Bienvenido {{ username }}</strong><br>
        Por favor establece tu contrase√±a para continuar
      </div>

      {# Mostrar mensaje de error si ocurri√≥ alg√∫n problema #}
      {% if error %}
      <div class="error" style="background-color: #f8d7da; color: #721c24; padding: 10px; margin: 10px auto; max-width: 520px; border-radius: 4px; border: 1px solid #f5c6cb;">
        {{ error }}
      </div>
      {% endif %}

      {# Formulario para establecer contrase√±a inicial #}
      <div class="centered-form">
        <form method="post" action="/set-password" onsubmit="return validatePassword()">
          {# Campo oculto con el nombre de usuario #}
          <input type="hidden" name="username" value="{{ username }}" />
          
          {# Campo de nueva contrase√±a #}
          <div style="margin-bottom: 10px;">
            <label>Nueva contrase√±a:<br>
              <div class="password-input-wrapper">
                <input id="password" name="password" type="password" required>
                <span class="toggle-password" onclick="togglePasswordVisibility('password', this)">üëÅÔ∏è</span>
              </div>
            </label>
          </div>

          {# Campo de confirmaci√≥n de contrase√±a #}
          <div style="margin-bottom: 10px;">
            <label>Confirmar contrase√±a:<br>
              <div class="password-input-wrapper">
                <input id="confirm_password" type="password" required>
                <span class="toggle-password" onclick="togglePasswordVisibility('confirm_password', this)">üëÅÔ∏è</span>
              </div>
            </label>
          </div>

          {# Mensaje de error si las contrase√±as no coinciden #}
          <div id="password-error" style="color: #ff6b6b; font-size: 0.9em; margin-bottom: 10px; display: none;">
            Las contrase√±as no coinciden
          </div>

          <div>
            <button type="submit">Establecer Contrase√±a</button>
          </div>
        </form>
      </div>
    </main>
  </body>
</html>
